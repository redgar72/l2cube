<!DOCTYPE html>
<html>

<head>
  <meta charset="utf8">
  <title>Rubik's Cube Tutorial</title>
  <link rel="stylesheet" href="./index.css">
  <script type="module" src="https://cdn.cubing.net/v0/js/cubing/twisty"></script>
</head>

<body>
  <!-- Navigation Sidebar -->
  <nav class="sidebar">
    <div class="sidebar-header">
      <h3>Navigation</h3>
      <button class="sidebar-toggle" id="sidebar-toggle">â˜°</button>
    </div>
    <ul class="sidebar-menu" id="sidebar-menu">
      <li><a href="#welcome" class="nav-link">Welcome</a></li>
      <li><a href="#move-definitions" class="nav-link">Move Definitions</a></li>
      <li class="nav-section">
        <span class="nav-section-title">Move Breakdowns</span>
        <ul class="nav-submenu">
          <li><a href="#face-turns-breakdown" class="nav-link">Face Turns</a></li>
          <li><a href="#wide-turns-breakdown" class="nav-link">Wide Turns</a></li>
          <li><a href="#slice-turns-breakdown" class="nav-link">Slice Turns</a></li>
          <li><a href="#rotations-breakdown" class="nav-link">Rotations</a></li>
        </ul>
      </li>
      <li><a href="#cross" class="nav-link">Cross</a></li>
      <li><a href="#f2l" class="nav-link">F2L</a></li>
    </ul>
  </nav>

  <div class="main-content">
    <div class="tutorial-container">
      <h1>Rubik's Cube Tutorial</h1>
      
      <div id="sections-container">
        <!-- Sections will be loaded here -->
      </div>
    </div>
  </div>

  <script src="./components/CubeComponent.js"></script>
  <script>
    window.addEventListener("DOMContentLoaded", async () => {
      const sectionsContainer = document.getElementById("sections-container");
      const sections = [
        "sections/welcome.html",
        "sections/move-definitions.html", 
        "sections/face-turns-breakdown.html",
        "sections/wide-turns-breakdown.html",
        "sections/slice-turns-breakdown.html",
        "sections/rotations-breakdown.html",
        "sections/cross.html",
        "sections/f2l.html"
      ];

      for (const sectionPath of sections) {
        try {
          const response = await fetch(sectionPath);
          const html = await response.text();
          sectionsContainer.insertAdjacentHTML("beforeend", html);
        } catch (error) {
          console.error(`Failed to load section: ${sectionPath}`, error);
        }
      }

      // Initialize cube components after sections are loaded
      initializeCubeComponents();
      initializeNavigation();
    });

    function scrollToSection(sectionClass) {
      const section = document.querySelector(`.${sectionClass}`);
      if (section) {
        section.scrollIntoView({ 
          behavior: 'smooth', 
          block: 'start' 
        });
      }
    }

    function initializeNavigation() {
      const sidebarToggle = document.getElementById('sidebar-toggle');
      const sidebar = document.querySelector('.sidebar');
      const navLinks = document.querySelectorAll('.nav-link');
      const navSectionTitles = document.querySelectorAll('.nav-section-title');

      // Toggle sidebar
      sidebarToggle.addEventListener('click', () => {
        sidebar.classList.toggle('collapsed');
      });

      // Handle navigation links
      navLinks.forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          const targetId = link.getAttribute('href').substring(1);
          const targetSection = document.querySelector(`.${targetId}`);
          
          if (targetSection) {
            targetSection.scrollIntoView({ 
              behavior: 'smooth', 
              block: 'start' 
            });
            
            // Update active state
            navLinks.forEach(l => l.classList.remove('active'));
            link.classList.add('active');
          }
        });
      });

      // Toggle submenu sections
      navSectionTitles.forEach(title => {
        title.addEventListener('click', () => {
          const submenu = title.nextElementSibling;
          submenu.classList.toggle('expanded');
          title.classList.toggle('expanded');
        });
      });

      // Auto-highlight current section based on scroll position
      window.addEventListener('scroll', () => {
        const sections = document.querySelectorAll('section');
        const scrollPos = window.scrollY + 100;

        sections.forEach(section => {
          const sectionTop = section.offsetTop;
          const sectionHeight = section.offsetHeight;
          const sectionId = section.className;

          if (scrollPos >= sectionTop && scrollPos < sectionTop + sectionHeight) {
            navLinks.forEach(link => {
              link.classList.remove('active');
              if (link.getAttribute('href') === `#${sectionId}`) {
                link.classList.add('active');
              }
            });
          }
        });
      });
    }

    function initializeCubeComponents() {
      // Welcome section - random moves with both 3D and 2D
      const welcomeContainer = document.getElementById("welcome-cube-container");
      if (welcomeContainer) {
        new CubeComponent(welcomeContainer, {
          title: "3D & 2D View",
          show2D: true,
          showMoveDisplay: true,
          moves: ["R", "U", "F", "L", "D", "B", "R'", "U'", "F'", "L'", "D'", "B'"],
          interval: 1500,
          setupAlg: "x2"
        });
      }

      // Face turns - clickable to scroll to breakdown
      const faceTurnsContainer = document.getElementById("face-turns-container");
      if (faceTurnsContainer) {
        new CubeComponent(faceTurnsContainer, {
          title: "Face Turns",
          show2D: false,
          showMoveDisplay: true,
          moves: ["R", "U", "F", "L", "D", "B"],
          interval: 2000,
          setupAlg: "x2",
          clickable: true,
          onClick: () => scrollToSection('face-turns-breakdown')
        });
      }

      // Wide turns - clickable to scroll to breakdown
      const wideTurnsContainer = document.getElementById("wide-turns-container");
      if (wideTurnsContainer) {
        new CubeComponent(wideTurnsContainer, {
          title: "Wide Turns",
          show2D: false,
          showMoveDisplay: true,
          moves: ["r", "u", "f", "l", "d", "b"],
          interval: 2000,
          setupAlg: "x2",
          clickable: true,
          onClick: () => scrollToSection('wide-turns-breakdown')
        });
      }

      // Slice turns - clickable to scroll to breakdown
      const sliceTurnsContainer = document.getElementById("slice-turns-container");
      if (sliceTurnsContainer) {
        new CubeComponent(sliceTurnsContainer, {
          title: "Slice Turns",
          show2D: false,
          showMoveDisplay: true,
          moves: ["M", "E", "S"],
          interval: 2000,
          setupAlg: "x2",
          clickable: true,
          onClick: () => scrollToSection('slice-turns-breakdown')
        });
      }

      // Rotations - clickable to scroll to breakdown
      const rotationsContainer = document.getElementById("rotations-container");
      if (rotationsContainer) {
        new CubeComponent(rotationsContainer, {
          title: "Rotations",
          show2D: false,
          showMoveDisplay: true,
          moves: ["x", "y", "z"],
          interval: 2000,
          setupAlg: "x2",
          clickable: true,
          onClick: () => scrollToSection('rotations-breakdown')
        });
      }

      // Initialize individual move components in breakdown sections
      initializeBreakdownComponents();
    }

    function initializeBreakdownComponents() {
      // Face turns breakdown - individual moves
      const faceMoves = [
        { id: 'r-move-container', move: 'R', title: 'R Move', row: 'row-1' },
        { id: 'u-move-container', move: 'U', title: 'U Move', row: 'row-1' },
        { id: 'f-move-container', move: 'F', title: 'F Move', row: 'row-1' },
        { id: 'l-move-container', move: 'L', title: 'L Move', row: 'row-2' },
        { id: 'd-move-container', move: 'D', title: 'D Move', row: 'row-2' },
        { id: 'b-move-container', move: 'B', title: 'B Move', row: 'row-2' }
      ];

      const faceComponents = [];
      const rowComponents = { 'row-1': [], 'row-2': [] };

      faceMoves.forEach(({ id, move, title, row }) => {
        const container = document.getElementById(id);
        if (container) {
          const component = new CubeComponent(container, {
            title: title,
            show2D: false,
            showMoveDisplay: true,
            moves: [move],
            interval: 3000,
            setupAlg: "x2",
            expandable: true,
            onExpand: (component) => {
              // Collapse all other rows first
              Object.values(rowComponents).forEach(rowComps => {
                rowComps.forEach(comp => {
                  if (comp !== component) {
                    comp.collapse();
                    comp.show(); // Make sure all components are visible initially
                  }
                });
              });
              
              // Hide other components in the same row
              const currentRow = rowComponents[row];
              currentRow.forEach(comp => {
                if (comp !== component) {
                  comp.hide();
                }
              });
              
              // Expand this component with base, prime, and double moves
              const baseMove = move;
              const primeMove = move + "'";
              const doubleMove = move + "2";
              
              component.setExpandedMoves([baseMove, primeMove, doubleMove]);
            },
            onCollapse: (component) => {
              // Show all components in the same row when this one collapses
              const currentRow = rowComponents[row];
              currentRow.forEach(comp => {
                comp.show();
              });
            }
          });
          
          faceComponents.push(component);
          rowComponents[row].push(component);
        }
      });

      // Wide turns breakdown - individual moves
      const wideMoves = [
        { id: 'r-wide-container', move: 'r', title: 'r Move' },
        { id: 'u-wide-container', move: 'u', title: 'u Move' },
        { id: 'f-wide-container', move: 'f', title: 'f Move' },
        { id: 'l-wide-container', move: 'l', title: 'l Move' },
        { id: 'd-wide-container', move: 'd', title: 'd Move' },
        { id: 'b-wide-container', move: 'b', title: 'b Move' }
      ];

      wideMoves.forEach(({ id, move, title }) => {
        const container = document.getElementById(id);
        if (container) {
          new CubeComponent(container, {
            title: title,
            show2D: false,
            showMoveDisplay: true,
            moves: [move],
            interval: 3000,
            setupAlg: "x2"
          });
        }
      });

      // Slice turns breakdown - individual moves
      const sliceMoves = [
        { id: 'm-slice-container', move: 'M', title: 'M Move' },
        { id: 'e-slice-container', move: 'E', title: 'E Move' },
        { id: 's-slice-container', move: 'S', title: 'S Move' }
      ];

      sliceMoves.forEach(({ id, move, title }) => {
        const container = document.getElementById(id);
        if (container) {
          new CubeComponent(container, {
            title: title,
            show2D: false,
            showMoveDisplay: true,
            moves: [move],
            interval: 3000,
            setupAlg: "x2"
          });
        }
      });

      // Rotations breakdown - individual moves
      const rotationMoves = [
        { id: 'x-rotation-container', move: 'x', title: 'x Rotation' },
        { id: 'y-rotation-container', move: 'y', title: 'y Rotation' },
        { id: 'z-rotation-container', move: 'z', title: 'z Rotation' }
      ];

      rotationMoves.forEach(({ id, move, title }) => {
        const container = document.getElementById(id);
        if (container) {
          new CubeComponent(container, {
            title: title,
            show2D: false,
            showMoveDisplay: true,
            moves: [move],
            interval: 3000,
            setupAlg: "x2"
          });
        }
      });
    }
  </script>
</body>

</html>
